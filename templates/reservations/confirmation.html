{% extends 'base.html' %}

{% block title %}Confirmation - AGCF Voyages{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-success">
                <div class="card-header bg-success text-white text-center">
                    <h3 class="mb-0">
                        <i class="bi bi-check-circle-fill"></i> Réservation confirmée !
                    </h3>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <i class="bi bi-check-circle text-success" style="font-size: 4rem;"></i>
                    </div>
                    <h4>Merci pour votre réservation !</h4>
                    <p class="lead">Votre code de réservation: <strong>{{ reservation.code_reservation }}</strong></p>
                    
                    <div class="alert alert-success mt-4">
                        <i class="bi bi-envelope-check"></i> 
                        <strong>Billet envoyé par email !</strong><br>
                        Votre billet électronique a été envoyé à <strong>{{ reservation.utilisateur.email }}</strong>
                    </div>
                    
                    {% if auto_download %}
                    <div class="alert alert-success">
                        <i class="bi bi-download"></i> 
                        <strong>Votre billet est en cours de téléchargement...</strong>
                    </div>
                    {% else %}
                    <div class="alert alert-primary">
                        <i class="bi bi-download"></i> 
                        <strong>Téléchargez votre billet</strong> ci-dessous pour l'avoir sur votre appareil.
                    </div>
                    {% endif %}
                    
                    <div class="card mt-4">
                        <div class="card-body text-start">
                            <h5>Détails de la réservation:</h5>
                            <hr>
                            <p><strong>Train:</strong> {{ reservation.train.numero }}</p>
                            <p><strong>Départ:</strong> {{ reservation.train.gare_depart.ville }} 
                               à {{ reservation.train.heure_depart|time:"H:i" }}</p>
                            <p><strong>Arrivée:</strong> {{ reservation.train.gare_arrivee.ville }} 
                               à {{ reservation.train.heure_arrivee|time:"H:i" }}</p>
                            <p><strong>Date:</strong> {{ reservation.date_voyage|date:"d/m/Y" }}</p>
                            <p><strong>Places:</strong> {{ reservation.nombre_places }}</p>
                            <p><strong>Prix total:</strong> {{ reservation.prix_total }} DH</p>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{% url 'reservations:telecharger_billet' reservation.code_reservation %}" 
                           class="btn btn-primary me-2">
                            <i class="bi bi-download"></i> Télécharger le billet PDF
                        </a>
                        <a href="{% url 'reservations:dashboard' %}" class="btn btn-outline-primary">
                            <i class="bi bi-speedometer2"></i> Aller au tableau de bord
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if auto_download %}
<script>
// Télécharger automatiquement le billet après le chargement de la page
window.addEventListener('load', function() {
    setTimeout(function() {
        window.location.href = "{% url 'reservations:telecharger_billet' reservation.code_reservation %}";
    }, 500); // Petit délai pour que la page se charge
});
</script>
{% endif %}
{% endblock %}

