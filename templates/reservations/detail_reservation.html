{% extends 'base.html' %}

{% block title %}Détails de la réservation - AGCF Voyages{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Réservation {{ reservation.code_reservation }}</h4>
                    {% if reservation.statut == 'confirmee' %}
                    <span class="badge bg-success fs-6">{{ reservation.get_statut_display }}</span>
                    {% elif reservation.statut == 'annulee' %}
                    <span class="badge bg-danger fs-6">{{ reservation.get_statut_display }}</span>
                    {% else %}
                    <span class="badge bg-warning fs-6">{{ reservation.get_statut_display }}</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <h5 class="mb-4">Informations du train</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Numéro de train:</strong> {{ reservation.train.numero }}</p>
                            <p><strong>Gare de départ:</strong><br>
                            {{ reservation.train.gare_depart.nom }}<br>
                            <small class="text-muted">{{ reservation.train.gare_depart.ville }}</small></p>
                            <p><strong>Heure de départ:</strong> {{ reservation.train.heure_depart|time:"H:i" }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Date de voyage:</strong> {{ reservation.date_voyage|date:"d/m/Y" }}</p>
                            <p><strong>Gare d'arrivée:</strong><br>
                            {{ reservation.train.gare_arrivee.nom }}<br>
                            <small class="text-muted">{{ reservation.train.gare_arrivee.ville }}</small></p>
                            <p><strong>Heure d'arrivée:</strong> {{ reservation.train.heure_arrivee|time:"H:i" }}</p>
                        </div>
                    </div>
                    <hr>
                    <p><strong>Durée:</strong> {{ reservation.train.duree_formatee }}</p>
                    <p><strong>Classe:</strong> {{ reservation.train.get_classe_display }}</p>
                    
                    <h5 class="mt-4 mb-3">Passagers</h5>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Prénom</th>
                                    <th>Date de naissance</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for passager in reservation.passagers.all %}
                                <tr>
                                    <td>{{ passager.nom }}</td>
                                    <td>{{ passager.prenom }}</td>
                                    <td>{{ passager.date_naissance|date:"d/m/Y" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <h5 class="mt-4 mb-3">Informations de paiement</h5>
                    <p><strong>Nombre de places:</strong> {{ reservation.nombre_places }}</p>
                    <p><strong>Prix unitaire:</strong> {{ reservation.prix_unitaire }} DH</p>
                    {% if reservation.carte_reduction %}
                    <p><strong>Carte de réduction:</strong> {{ reservation.carte_reduction.carte.nom }}</p>
                    <p><strong>Réduction appliquée:</strong> -{{ reservation.reduction_appliquee }} DH</p>
                    {% endif %}
                    <p><strong>Prix total:</strong> <span class="text-primary fw-bold fs-5">{{ reservation.prix_total }} DH</span></p>
                    {% if reservation.mode_paiement %}
                    <p><strong>Mode de paiement:</strong> {{ reservation.get_mode_paiement_display }}</p>
                    {% endif %}
                    {% if reservation.date_paiement %}
                    <p><strong>Date de paiement:</strong> {{ reservation.date_paiement|date:"d/m/Y H:i" }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Actions</h5>
                </div>
                <div class="card-body">
                    {% if reservation.statut == 'confirmee' %}
                    <a href="{% url 'reservations:telecharger_billet' reservation.code_reservation %}" 
                       class="btn btn-success w-100 mb-2">
                        <i class="bi bi-download"></i> Télécharger le billet PDF
                    </a>
                    {% endif %}
                    
                    {% if reservation.statut != 'annulee' and reservation.statut != 'utilisee' %}
                    <a href="{% url 'reservations:annuler_reservation' reservation.code_reservation %}" 
                       class="btn btn-danger w-100 mb-2">
                        <i class="bi bi-x-circle"></i> Annuler la réservation
                    </a>
                    {% endif %}
                    
                    <a href="{% url 'reservations:mes_reservations' %}" 
                       class="btn btn-outline-secondary w-100">
                        <i class="bi bi-arrow-left"></i> Retour aux réservations
                    </a>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">Politique d'annulation</h6>
                </div>
                <div class="card-body">
                    <small>
                        <strong>Annulation gratuite:</strong> Jusqu'à 48h avant le départ<br><br>
                        <strong>Frais d'annulation:</strong> 10% du prix total entre 48h et 24h avant le départ<br><br>
                        <strong>Non remboursable:</strong> Moins de 24h avant le départ
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

